---
- name: Get the Ngroak URL
  shell: curl -s https://ngrok.com/download | grep 'id="dl-linux-amd64"' | grep -o "href=\".*.zip" | cut -d\" -f 2
  register: ngrokUrl
  ignore_errors: Yes
  changed_when: No

- name: Download the ZIP
  get_url:
    url: "{{ ngrokUrl.stdout }}"
    dest: "/tmp/ngrok.zip"
  ignore_errors: Yes
  changed_when: No

- name: "Unarchive zip"
  unarchive:
    src: "/tmp/ngrok.zip"
    dest: "/tmp/"
    copy: No
  changed_when: No

- name: Get The Ngroak version from zip
  shell: /tmp/ngrok --version 2> /dev/null | awk '{print $3}'
  register: ngrokNewVersion
  ignore_errors: Yes
  changed_when: No

- name: Get The Ngroak installed version
  shell: ngrok --version 2> /dev/null | awk '{print $3}'
  register: ngrokVersion
  ignore_errors: Yes
  changed_when: No



- name: Show hub version variable
  debug: msg="ngrokUrl={{ ngrokUrl.stdout }} | ngrokVersion={{ ngrokVersion.stdout }}"
