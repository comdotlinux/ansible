---
- name: Get the Ngroak URL
  shell: curl -s https://ngrok.com/download | grep 'id="dl-linux-amd64"' | grep -o "href=\".*.zip" | cut -d\" -f 2
  register: ngrokUrl
  ignore_errors: True
  changed_when: False

- name: Download the ZIP
  get_url:
    url: "{{ ngrokUrl.stdout }}"
    dest: "/tmp/ngrok.zip"
  ignore_errors: True
  changed_when: False

- name: "Unarchive zip"
  unarchive:
    src: "/tmp/ngrok.zip"
    dest: "/tmp/"
    copy: False
  changed_when: False

- name: Get The Ngroak version from zip
  shell: /tmp/ngrok --version 2> /dev/null | awk '{print $3}'
  register: ngrokNewVersion
  ignore_errors: True
  changed_when: False

- name: Check if ngrok is installed
  stat:
    file: /usr/local/bin/ngrok
  register: ngrok
  ignore_errors: True

- name: Show ngrok version variable
  debug:
    msg: "ngrokUrl={{ ngrokUrl.stdout }} | ngrok={{ ngrok }}"

- name: Get The Ngroak installed version
  shell: /usr/local/bin/hub --version 2> /dev/null | awk '{print $3}'
  register: ngrokVersion
  ignore_errors: True
  changed_when: False
